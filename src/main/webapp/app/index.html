<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=description content="An Amaze UI template that helps you build fast, modern mobile web apps."><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><title>发现</title><meta name=renderer content=webkit><meta http-equiv=Cache-Control content=no-siteapp><link rel=icon type=image/png href=i/favicon.png><link rel=manifest href=manifest.json><meta name=mobile-web-app-capable content=yes><meta name=application-name content="Web Starter Kit"><link rel=icon sizes=192x192 href=i/touch/chrome-touch-icon-192x192.png><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=black><meta name=apple-mobile-web-app-title content="Amaze UI Sfavicon.pngtarter Kit"><link rel=apple-touch-icon href=i/touch/apple-touch-icon.png><meta name=msapplication-TileImage content=i/touch/ms-touch-icon-144x144-precomposed.png><meta name=msapplication-TileColor content=#0e90d2><link rel=stylesheet href=css/amazeui.min.css><link rel=stylesheet href=css/swiper.min.css><link rel=stylesheet href=css/main.min.css><style>
    #header {
      position: fixed;
      left: 0;
      top: 0;
      z-index: 999;
      width: 100%;
      height: 38px;
      line-height: 38px;
      overflow: hidden;
      background: #f4f4f4;
      color: #565656;
    }

    #header .swiper-slide {
      padding: 0 10px;
      width: auto;
      text-align: center;
      font-size: 1.4rem;

    }

    .swiper-wrapper .swiper-slide:nth-last-child(1) {
      margin-right: 20px;
    }

    .swiper-wrapper .swiper-slide:nth-child(1) {
      margin-left: 10px !important;
    }


  </style></head><body><img src=i/icon/loading.gif alt=读取 id=articles-loading height=80><div class="am-tabs am-tabs-d2 app-body"><div class=today-bar>今日推荐</div><div class=today-white><img src=i/header/white.png></div><div id=header><div class=swiper-wrapper><div class=swiper-slide style="width: 100px;"></div></div></div><div class=am-tabs-bd><div class="am-tab-panel am-active today-body"><div id=banners><div class=banner-today><div class=banner-today-img></div><div class="banner-today-title-bg am-cf"><div class="banner-today-title am-text-truncate"></div><div class=banner-today-click><img src=i/icon/read.png alt=阅读></div></div></div></div><div data-am-widget=list_news class="am-list-news am-list-news-default today-list"><div class=am-list-news-bd><ul class="am-list article" id=article><li class="am-g am-list-item-desced am-list-item-thumbed am-list-item-thumb-left" style="display: none;"><div class="am-u-sm-4 am-list-thumb article-img-box"><a href=# class=article-href><img class=article-img></a></div><div class="am-u-sm-8 am-list-main article-content-box"><h3 class=am-list-item-hd><a href=# class="article-title article-href"></a></h3><div class="am-list-item-text article-description"></div><div class=article-clickCount></div></div></li></ul></div></div></div></div></div></body><script src=js/jquery.min.js></script><script src=js/amazeui.min.js></script><script src=js/main.js></script><script src=js/swiper.js></script><script type=text/javascript>
  window.onload = function () {
  }
  var articleList;
  var commonUrl = 'http://101.231.124.8:45677/xlab-healthcloud/';

  var articleUrl = commonUrl + 'discovery/app/recommand/articles/';
  var healthCategoryId = 2;
  var typeUrl = commonUrl + 'discovery/app/recommand/tags/';
  var typeTagUrl = commonUrl + 'discovery/app/recommand/tags/';
  var typeArticleUrl = commonUrl + 'discovery/app/recommand/tag/articles/';

  var articleBack;
  var bannerBack = $('.banner-today');
  var mySwiper;

  if (sessionStorage.getItem('articleUrl') != null) {
    loadArticles(sessionStorage.getItem('tag'));
  }
  else {
    inLoad();
  }

  function inLoad() {
    $('.today-body').removeClass('today-body-banners');
    $('#articles-loading').show();
    $.get(articleUrl + healthCategoryId, function (data) {
      //console.log(data.ret_values);
      var values = data.ret_values, $article = $('.article');
      articleList = values;
      var u = '';
      $.each(values, function (n, value) {
        //console.log(articleList[n]);
        var articleItem =  localStorage.getItem('article');
        if(articleItem!=null && JSON.parse(articleItem).id==value.id){
          value.clickCount++;
        }
        if (n === 0) {
          $('.banner-today-img').css('background', 'url("' + value.pictureUrl2 + '") 50% 50% / cover no-repeat');
          $('.banner-today-title').html(value.title);
          $('.banner-today-click').append(value.clickCount + '阅读');
          $('.banner-today-click').attr('id', 'click' + value.id);
          $('.banner-today-img').attr('onclick', 'getDetails(\'' + n + '\');');
          $('.banner-today').show();
          //console.log('getDetails('+healthCategoryId+'/'+value.id+');');
        }
        else {
          $article.find('.article-img').attr('src', value.pictureUrl);
          $article.find('li').css('display', 'block');
          $article.find('.article-title').html(value.title);
          $article.find('.article-description').html(value.desc);
          $article.find('.article-clickCount').html('<img src="i/icon/read-grey.png" alt="阅读"/>' + value.clickCount + '阅读');
          $article.find('.article-clickCount').attr('id', 'click' + value.id);
          $article.find('li').attr('onclick', 'getDetails(\'' + n + '\')');
          u = u + $article.html();
        }
      });
      //$('.article  li:first').siblings().remove();
      articleBack = $article.find('li:eq(0)').detach();
      $('#article').append(u).show();
      $('#articles-loading').hide();


    });
  }


  function getDetails(id) {
    var articleId = articleList[id].id || JSON.parse(localStorage.getItem('articleList')[id].id);
    var clickUrl = commonUrl + 'discovery/app/clickInfo/' + healthCategoryId + '/' + articleId;
    $.get(clickUrl, function (data) {
      localStorage.setItem('article', JSON.stringify(articleList[id]));
      localStorage.setItem('articleList', JSON.stringify(articleList));
      window.location.href = 'detail.html?' + articleId;
    });
  }


  function loadArticles(id) {
    $('#articles-loading').show();
    $('.today-body').addClass('today-body-banners');
    typeArticleUrl = typeArticleUrl + id + '/' + healthCategoryId;
    $('#banners').html(bannerBack.hide());
    var $article = $('.article');
    if (typeof(articleBack) == 'undefined' || articleBack.length == 0) {
      articleBack = $article.find('li:eq(0)').detach();
    }
    $('#article').html('');
    if (typeof(mySwiper) != 'undefined') {
      mySwiper.removeAllSlides();
    }
    $.get(typeTagUrl + healthCategoryId + '/' + id, function (data) {
      data = data.ret_values;
      //console.log(data);
      $('.swiper-wrapper').html('<div class="swiper-slide" style="width: 100px;"></div>');
      var types = '';
      $.each(data, function (n, value) {
        types += '<div class=\'swiper-slide\' ' +
        'onclick=\'loadArticles(' + value.id + ')\'>' + value.tag + '</div>';
      });
      $('.swiper-wrapper').append(types);
      var swiper = $('.swiper-wrapper').find('.swiper-slide:eq(1)');
      swiper.addClass('swiper-active');
//      sessionStorage.setItem('onclick',  swiper.attr('onclick'));
      swiper.attr('onclick', '');
      $('.today-bar').attr('onclick', 'loadTodayArticles()');
      $('.today-bar').addClass('today-bar-noactive');
      mySwiper = new Swiper('#header', {
        initialSlide: 0,
        freeMode: true,
        slidesPerView: 'auto'
      });

    });


    $.get(typeArticleUrl, function (data) {
//      console.log(data.ret_values);
      var values = data.ret_values;
      articleList = values;
      var u = '';
      $.each(values, function (n, value) {
        var articleItem =  localStorage.getItem('article');
        var clickCount=value.clickCount;
        if(articleItem!=null && JSON.parse(articleItem).id==value.id){
          console.log(articleItem);
          clickCount=value.clickCount+1;
          console.log(clickCount);
        }
        $('.banner-today-img').css('background', 'url("' + value.pictureUrl2 + '") 50% 50% / cover no-repeat');
        $('.banner-today-title').html(value.title);
        $('.banner-today-click').attr('id', 'click' + value.id);
        $('.banner-today-click').html('<img src="i/icon/read.png" alt="阅读"/>' + clickCount + '阅读');
        $('.banner-today-img').attr('onclick', 'getDetails(\'' + n + '\');');
        $('.banner-today').show();
        u = u + $('#banners').html();
      });
      bannerBack = $('#banners').find('.banner-today:eq(0)').detach();
      $('#banners').append(u).show();
      typeArticleUrl = commonUrl + 'discovery/app/recommand/tag/articles/';
      sessionStorage.setItem('articleUrl', typeArticleUrl);
      sessionStorage.setItem('tag', id);
      console.log(articleBack);
      $('#articles-loading').hide();

    });


  }


  function loadTodayArticles() {
    $('#articles-loading').show();
    $('.today-body').removeClass('today-body-banners');
    $('.today-bar').attr('onclick', '');
    $('.article').html(articleBack.hide());
    $('#banners').html(bannerBack.hide());
    if (typeof(mySwiper) != 'undefined') {
      mySwiper.removeAllSlides();
    }
    $.get(typeUrl + healthCategoryId, function (data) {
      data = data.ret_values;
      //console.log(data);
      $('.swiper-wrapper').html('<div class="swiper-slide" style="width: 100px;"></div>');
      var types = '';
      $.each(data, function (n, value) {
        types += '<div class=\'swiper-slide\' ' +
        'onclick=\'loadArticles(' + value.id + ')\'>' + value.tag + '</div>';
      });
      $('.swiper-wrapper').append(types);
      var swiper = $('.swiper-wrapper').find('.swiper-slide:eq(1)');
      swiper.removeClass('swiper-active');
      $('.today-bar').removeClass('today-bar-noactive');
      mySwiper = new Swiper('#header', {
        initialSlide: 0,
        freeMode: true,
        slidesPerView: 'auto'
      });

    });

    $.get(articleUrl + healthCategoryId, function (data) {
//      console.log(data.ret_values);
      var values = data.ret_values, $article = $('.article');
      articleList = values;
      var u = '';
      $.each(values, function (n, value) {
//        console.log(n);
        if (n === 0) {
          $('.banner-today-img').css('background', 'url("' + value.pictureUrl2 + '") 50% 50% / cover no-repeat');
          $('.banner-today-title').html(value.title);
          $('.banner-today-click').attr('id', 'click' + value.id);
          $('.banner-today-click').html('<img src="i/icon/read.png" alt="阅读"/>' + value.clickCount + '阅读');
          $('.banner-today').show();
          $('.banner-today-img').attr('onclick', 'getDetails(\'' + n + '\');');
          //console.log('getDetails('+healthCategoryId+'/'+value.id+');');
        }
        else {
          $article.find('.article-img').attr('src', value.pictureUrl);
          $article.find('li').css('display', 'block');
          $article.find('.article-title').html(value.title);
          $article.find('.article-description').html(value.desc);
          $article.find('li').attr('onclick', 'getDetails(\'' + n + '\')');
          $article.find('.article-clickCount').html('<img src="i/icon/read-grey.png" alt="阅读"/>' + value.clickCount + '阅读');
          $article.find('.article-clickCount').attr('id', 'click' + value.id);
          ;
          u = u + $article.html();
        }

      });
//      $('.article  li:first').siblings().remove();
      articleBack = $article.find('li:eq(0)').detach();
      $('#article').append(u).show();
      typeArticleUrl = commonUrl + 'discovery/app/recommand/tag/articles/';
      sessionStorage.removeItem('articleUrl');
      $('#articles-loading').hide();
    })
  }


  $.get(typeUrl + healthCategoryId, function (data) {
    data = data.ret_values;
    //console.log(data);
    var types = '';
    $.each(data, function (n, value) {
      types += '<div class=\'swiper-slide\' ' +
      'onclick=\'loadArticles(' + value.id + ')\'>' + value.tag + '</div>';
    });
    $('.swiper-wrapper').append(types);
    mySwiper = new Swiper('#header', {
      initialSlide: 0,
      freeMode: true,
      slidesPerView: 'auto'
    });

  });

</script></html>